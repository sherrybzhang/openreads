{% extends "base.html" %}

{% block head %}
<title>OpenReads</title>

{% endblock %}

{% block body %}
<header class="site-header">
  <a class="brand brand-link" href="{{ url_for('search') if current_user else url_for('index') }}">
    <div class="brand-mark">OR</div>
    <div>
      <div class="brand-name">OpenReads</div>
      <p class="brand-tag">Book details</p>
    </div>
  </a>
  {% if current_user %}
    <div class="header-actions">
      <a class="profile-icon" href="{{ url_for('profile') }}" aria-label="Profile">
        <img src="{{ url_for('static', filename='profile.png') }}" alt="Profile">
      </a>
      <form action="/logout" method="POST">
        <button class="btn btn-ghost" type="submit">Logout</button>
      </form>
    </div>
  {% endif %}
</header>

<section class="card" style="--delay: 0.05s;">
  <h1>{{ title }}</h1>
  <p class="muted">Details and community reviews for this title.</p>

  <div class="spec-grid">
    <div class="spec">
      <span class="spec-label">Author</span>
      <span>{{ author }}</span>
    </div>
    <div class="spec">
      <span class="spec-label">Year</span>
      <span>{{ year }}</span>
    </div>
    <div class="spec">
      <span class="spec-label">ISBN</span>
      <span>{{ isbn }}</span>
    </div>
    <div class="spec">
      <span class="spec-label">OpenReads Avg Rating</span>
      <span>
        {{ ("%.1f" % localAverageRating) if localAverageRating is not none else "N/A" }}
      </span>
    </div>
    <div class="spec">
      <span class="spec-label">OpenReads Reviews</span>
      <span>{{ localReviewCount }}</span>
    </div>
  </div>

  <form action="/return-to-search" method="POST" style="margin-top: 18px;">
    <button class="btn btn-ghost" type="submit">Return to Search</button>
  </form>
</section>

<section class="grid-2" style="margin-top: 24px;">
  <div class="card" style="--delay: 0.12s;">
    <h3>Write a Review</h3>
    {% if review_error %}
      <div class="alert" style="margin-top: 12px;">{{ review_error }}</div>
    {% endif %}
    <form class="stack" action="/review" method="POST">
      <div class="field">
        <label for="rating">Rating</label>
        <div class="select">
          <select id="rating" name="rating">
            <option value="1">1</option>
            <option value="2">2</option>
            <option value="3">3</option>
            <option value="4">4</option>
            <option value="5">5</option>
          </select>
        </div>
      </div>
      <div class="field">
        <label for="review">Review</label>
        <textarea id="review" name="review" rows="6"></textarea>
      </div>
      <button class="btn" type="submit">Submit Review</button>
      <input type="text" id="isbn" name="isbn" value="{{ isbn }}" hidden="True">
    </form>
  </div>

  <div class="card soft" style="--delay: 0.18s;">
    <h3>Reviews</h3>
    {% if reviews %}
      <div class="stack">
        {% for review in reviews %}
          <div class="spec">
            <div style="font-weight: 600;">{{ review.username }}</div>
            <div class="muted" style="font-size: 0.9rem;">
              Rating: {{ review.rating }} / 5
            </div>
            {% if review.review %}
              <p class="review-text">{{ review.review }}</p>
            {% endif %}
          </div>
        {% endfor %}
      </div>
    {% else %}
      <p class="muted">No reviews yet. Be the first to leave one.</p>
    {% endif %}
  </div>
</section>

{% endblock %}
